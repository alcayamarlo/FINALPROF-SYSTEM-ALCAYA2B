/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package admin;
import java.sql.*;
import Project.ConnectionProvider;
import com.mysql.cj.protocol.Resultset;
import config.dbConnect;
import javax.swing.JOptionPane;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author alcay
 */
public class addBill extends javax.swing.JFrame {

    /** Creates new form addBill */
    public addBill() {
        initComponents();
       
        id.setEditable(false); // Make Patient ID field non-editable
        name.setEditable(false); // Make Patient Name field non-editable
    }
    




    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel19 = new javax.swing.JLabel();
        id = new textfield.TextField();
        status = new textfield.TextField();
        name = new textfield.TextField();
        total = new textfield.TextField();
        balance = new textfield.TextField();
        jLabel10 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        type = new textfield.TextField();
        date = new textfield.TextField();
        rSMaterialButtonCircle1 = new rojerusan.RSMaterialButtonCircle();
        paid = new textfield.TextField();
        jScrollPane1 = new javax.swing.JScrollPane();
        rSTableMetro1 = new rojeru_san.complementos.RSTableMetro();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jPanel1.setBackground(new java.awt.Color(204, 255, 255));
        jPanel1.setBorder(javax.swing.BorderFactory.createMatteBorder(2, 2, 2, 2, new java.awt.Color(51, 51, 255)));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel19.setFont(new java.awt.Font("Arial Black", 0, 36)); // NOI18N
        jLabel19.setForeground(new java.awt.Color(102, 102, 102));
        jLabel19.setIcon(new javax.swing.ImageIcon(getClass().getResource("/dashboardImage/Billing ani.gif"))); // NOI18N
        jPanel1.add(jLabel19, new org.netbeans.lib.awtextra.AbsoluteConstraints(390, 10, -1, 110));

        id.setBackground(new java.awt.Color(204, 255, 255));
        id.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        id.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        id.setLabelText("Patient_id");
        id.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                idActionPerformed(evt);
            }
        });
        jPanel1.add(id, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 440, 210, 60));

        status.setBackground(new java.awt.Color(204, 255, 255));
        status.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        status.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        status.setLabelText("Billing Status");
        jPanel1.add(status, new org.netbeans.lib.awtextra.AbsoluteConstraints(1000, 440, 220, 60));

        name.setBackground(new java.awt.Color(204, 255, 255));
        name.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        name.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        name.setLabelText("Name");
        jPanel1.add(name, new org.netbeans.lib.awtextra.AbsoluteConstraints(270, 440, 210, 60));

        total.setBackground(new java.awt.Color(204, 255, 255));
        total.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        total.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        total.setLabelText("Enter your Total Amount");
        total.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                totalActionPerformed(evt);
            }
        });
        jPanel1.add(total, new org.netbeans.lib.awtextra.AbsoluteConstraints(690, 630, 220, 60));

        balance.setBackground(new java.awt.Color(204, 255, 255));
        balance.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        balance.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        balance.setLabelText("Balance Return");
        jPanel1.add(balance, new org.netbeans.lib.awtextra.AbsoluteConstraints(690, 780, 220, 60));

        jLabel10.setFont(new java.awt.Font("Segoe UI Semilight", 0, 15)); // NOI18N
        jLabel10.setForeground(new java.awt.Color(102, 102, 102));
        jLabel10.setText("Add user information.");
        jPanel1.add(jLabel10, new org.netbeans.lib.awtextra.AbsoluteConstraints(460, 90, -1, 30));

        jLabel2.setText("Billing Details");
        jPanel1.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 140, -1, -1));

        type.setBackground(new java.awt.Color(204, 255, 255));
        type.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        type.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        type.setLabelText("Enter your TreatmentType");
        type.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                typeActionPerformed(evt);
            }
        });
        jPanel1.add(type, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 440, 220, 60));

        date.setBackground(new java.awt.Color(204, 255, 255));
        date.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        date.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        date.setLabelText("Enter Billing Date");
        jPanel1.add(date, new org.netbeans.lib.awtextra.AbsoluteConstraints(750, 440, 220, 60));

        rSMaterialButtonCircle1.setText("ADD BILLS");
        rSMaterialButtonCircle1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                rSMaterialButtonCircle1MouseClicked(evt);
            }
        });
        jPanel1.add(rSMaterialButtonCircle1, new org.netbeans.lib.awtextra.AbsoluteConstraints(980, 760, 120, 70));

        paid.setBackground(new java.awt.Color(204, 255, 255));
        paid.setDisabledTextColor(new java.awt.Color(255, 255, 255));
        paid.setFont(new java.awt.Font("Segoe UI Semilight", 0, 16)); // NOI18N
        paid.setLabelText("Enter your AmountPaid");
        jPanel1.add(paid, new org.netbeans.lib.awtextra.AbsoluteConstraints(690, 700, 220, 60));

        rSTableMetro1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        jScrollPane1.setViewportView(rSTableMetro1);

        jPanel1.add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 582, 640, 270));

        getContentPane().add(jPanel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1250, 890));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void idActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_idActionPerformed
       
    }//GEN-LAST:event_idActionPerformed

    private void totalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_totalActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_totalActionPerformed

    private void typeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_typeActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_typeActionPerformed

    private void rSMaterialButtonCircle1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_rSMaterialButtonCircle1MouseClicked
        String patientID = id.getText();
        String fname = name.getText(); // Get name from the non-editable field
        String treatment = type.getText().trim();
        String totalAmount = total.getText().trim();
        String paidAmount = paid.getText().trim();
        String billDate = date.getText().trim();

        if (patientID.isEmpty() || fname.isEmpty() || treatment.isEmpty() || totalAmount.isEmpty() || paidAmount.isEmpty() || billDate.isEmpty()) {
            JOptionPane.showMessageDialog(null, "All billing details are required.");
            return;
        }

        try {
            double totalAmountValue = Double.parseDouble(totalAmount);
            double amountPaidValue = Double.parseDouble(paidAmount);
            double balanceValue = totalAmountValue - amountPaidValue;
            balance.setText(String.format("%.2f", balanceValue));

            // Assuming default BillingStatus as 'Pending', you might want to add a way to select this
            String billingStatus = (balanceValue > 0) ? "Pending" : "Paid";

            Connection con = ConnectionProvider.getCon();
            PreparedStatement pst = con.prepareStatement("INSERT INTO tbl_billings (p_id, Name, treatmentType, TotalAmount, AmountPaid, Date, BillingStatus) VALUES (?, ?, ?, ?, ?, ?, ?)");
            pst.setString(1, patientID);
            pst.setString(2, fname);
            pst.setString(3, treatment);
            pst.setDouble(4, totalAmountValue);
            pst.setDouble(5, amountPaidValue);
            pst.setString(6, billDate);
            pst.setString(7, billingStatus);

            int rowsInserted = pst.executeUpdate();
            if (rowsInserted > 0) {
                JOptionPane.showMessageDialog(null, "Bill added successfully.");
                id.setText(patientID); // Reload bills for the updated list
                type.setText("");
                total.setText("");
                paid.setText("");
                date.setText("");
                balance.setText("");
            } else {
                JOptionPane.showMessageDialog(null, "Failed to add bill.");
            }

            con.close();
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(null, "Invalid amount format.");
        } catch (SQLException e) {
            JOptionPane.showMessageDialog(null, "Error adding bill: " + e.getMessage());
            e.printStackTrace();
        }
   
    }//GEN-LAST:event_rSMaterialButtonCircle1MouseClicked

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(addBill.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(addBill.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(addBill.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(addBill.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new addBill().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    public textfield.TextField balance;
    public textfield.TextField date;
    public textfield.TextField id;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    public textfield.TextField name;
    public textfield.TextField paid;
    private rojerusan.RSMaterialButtonCircle rSMaterialButtonCircle1;
    private rojeru_san.complementos.RSTableMetro rSTableMetro1;
    public textfield.TextField status;
    public textfield.TextField total;
    public textfield.TextField type;
    // End of variables declaration//GEN-END:variables

}
